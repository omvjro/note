<!DOCTYPE html><html lang="zh-CN" id="html"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>omvjro<!-- -->&#x27;s website</title><meta name="next-head-count" content="3"/><link rel="shortcut icon" href="./favicon.ico"/><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/note/_next/static/css/15c171605c09b7dc.css" as="style" crossorigin=""/><link rel="stylesheet" href="/note/_next/static/css/15c171605c09b7dc.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/note/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/note/_next/static/chunks/webpack-814f3a0949786058.js" defer="" crossorigin=""></script><script src="/note/_next/static/chunks/framework-ed66dd8a32a1d8f6.js" defer="" crossorigin=""></script><script src="/note/_next/static/chunks/main-64d31a590a51b8f1.js" defer="" crossorigin=""></script><script src="/note/_next/static/chunks/pages/_app-28f7a80823b66374.js" defer="" crossorigin=""></script><script src="/note/_next/static/chunks/610-289babee075c1094.js" defer="" crossorigin=""></script><script src="/note/_next/static/chunks/914-0029599c095eb92c.js" defer="" crossorigin=""></script><script src="/note/_next/static/chunks/pages/post/%5Bid%5D-dfd04df4139e7733.js" defer="" crossorigin=""></script><script src="/note/_next/static/oTtmgtPvCncH-HN5g4SuZ/_buildManifest.js" defer="" crossorigin=""></script><script src="/note/_next/static/oTtmgtPvCncH-HN5g4SuZ/_ssgManifest.js" defer="" crossorigin=""></script></head><body class="dark:bg-black bg-slate-50"><div id="__next"><script>!function(){try{var d=document.documentElement,n='data-theme',s='setAttribute';var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';d[s](n,'dark')}else{d.style.colorScheme = 'light';d[s](n,'light')}}else if(e){d[s](n,e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="flex flex-col h-screen container w-full md:w-3/4 xl:w-1/2"><header><div class="my-10 flex self-center flex-row justify-between"><div class="flex self-center flex-row justify-between"><a class="md:text-2xl text-xl cursor-pointer dark:hover:text-white dark:text-gray-400 text-gray-500 hover:text-black transition-colors duration-200 font-en" href="/note">cd ..</a></div><div class="self-center text-sm sm:text-lg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2em" height="2em" viewBox="0 0 24 24" class="cursor-pointer"><path fill="currentColor" d="M12 5q-.425 0-.712-.288Q11 4.425 11 4V2q0-.425.288-.713Q11.575 1 12 1t.713.287Q13 1.575 13 2v2q0 .425-.287.712Q12.425 5 12 5Zm4.95 2.05q-.275-.275-.275-.688q0-.412.275-.712l1.4-1.425q.3-.3.712-.3q.413 0 .713.3q.275.275.275.7q0 .425-.275.7L18.35 7.05q-.275.275-.7.275q-.425 0-.7-.275ZM20 13q-.425 0-.712-.288Q19 12.425 19 12t.288-.713Q19.575 11 20 11h2q.425 0 .712.287q.288.288.288.713t-.288.712Q22.425 13 22 13Zm-8 10q-.425 0-.712-.288Q11 22.425 11 22v-2q0-.425.288-.712Q11.575 19 12 19t.713.288Q13 19.575 13 20v2q0 .425-.287.712Q12.425 23 12 23ZM5.65 7.05l-1.425-1.4q-.3-.3-.3-.725t.3-.7q.275-.275.7-.275q.425 0 .7.275L7.05 5.65q.275.275.275.7q0 .425-.275.7q-.3.275-.7.275q-.4 0-.7-.275Zm12.7 12.725l-1.4-1.425q-.275-.3-.275-.712q0-.413.275-.688q.275-.275.688-.275q.412 0 .712.275l1.425 1.4q.3.275.287.7q-.012.425-.287.725q-.3.3-.725.3t-.7-.3ZM2 13q-.425 0-.712-.288Q1 12.425 1 12t.288-.713Q1.575 11 2 11h2q.425 0 .713.287Q5 11.575 5 12t-.287.712Q4.425 13 4 13Zm2.225 6.775q-.275-.275-.275-.7q0-.425.275-.7L5.65 16.95q.275-.275.688-.275q.412 0 .712.275q.3.3.3.713q0 .412-.3.712l-1.4 1.4q-.3.3-.725.3t-.7-.3ZM12 18q-2.5 0-4.25-1.75T6 12q0-2.5 1.75-4.25T12 6q2.5 0 4.25 1.75T18 12q0 2.5-1.75 4.25T12 18Zm0-2q1.65 0 2.825-1.175Q16 13.65 16 12q0-1.65-1.175-2.825Q13.65 8 12 8q-1.65 0-2.825 1.175Q8 10.35 8 12q0 1.65 1.175 2.825Q10.35 16 12 16Z"></path></svg></div></div></header><main class="grow"><div><div class="flex flex-col mb-2"><div class="text-4xl sm:text-4xl font-medium dark:text-gray-200">MediaWiki 语言变体补遗</div><div class="sm:text-lg text-sm mt-2 dark:text-gray-400"><span>5月13日</span> / <span>5月13日</span></div></div><br/><div class="font-normal"><p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">如先前所述，利用 JavaScript 实现的变体转换存在需要额外创建繁体标题重定向的问题。和更改站点内容语言一样，对于已有一定规模的 wiki 来说，这是很麻烦的一件事。</p>
<div class="mt-12 mb-6"><h2 class="sm:text-3xl text-2xl dark:text-white">手动创建脚本</h2><hr class="dark:border-dashed mt-1"/></div>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">利用此脚本可以为每个页面添加快速创建繁体重定向的按钮，所依赖的 API 有 jQuery、<a href="https://github.com/nk2028/opencc-js" node="[object Object]" class="text-blue-500 hover:text-blue-800 after:content-[&#x27;_↗&#x27;] transition-colors duration-200">openccjs</a>，以及 MediaWiki 自身提供的 <a href="https://www.mediawiki.org/wiki/API:Main_page" node="[object Object]" class="text-blue-500 hover:text-blue-800 after:content-[&#x27;_↗&#x27;] transition-colors duration-200">Action API</a>。</p>
<pre><div node="[object Object]" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:1.8rem 0;overflow:auto;border-radius:0.5rem"><code class="font-en text-md" style="white-space:pre"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">1</span><span class="token" style="color:#DD4A68">$</span><span class="token" style="color:#999">(</span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">2</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">3</span><span></span><span class="token" style="color:slategray">// 仅在内容页面启用</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">4</span><span></span><span class="token control-flow" style="color:#07a">if</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">!</span><span>mw</span><span class="token" style="color:#999">.</span><span class="token property-access">config</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">get</span><span class="token" style="color:#999">(</span><span> </span><span class="token" style="color:#690">&#x27;wgIsArticle&#x27;</span><span> </span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">||</span><span> mw</span><span class="token" style="color:#999">.</span><span class="token property-access">config</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">get</span><span class="token" style="color:#999">(</span><span> </span><span class="token" style="color:#690">&#x27;wgPageContentModel&#x27;</span><span> </span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">!==</span><span> </span><span class="token" style="color:#690">&#x27;wikitext&#x27;</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span> </span><span class="token control-flow" style="color:#07a">return</span><span> </span><span class="token" style="color:#999">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">5</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">6</span><span></span><span class="token" style="color:slategray">// 检查重定向页面是否已存在</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">7</span><span></span><span class="token" style="color:#07a">const</span><span> </span><span class="token function-variable" style="color:#DD4A68">ifExist</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token parameter">title</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">8</span><span>  </span><span class="token control-flow" style="color:#07a">return</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">Promise</span><span class="token" style="color:#999">(</span><span class="token parameter">resolve</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">9</span><span>    </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">mw</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">Api</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">get</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">10</span><span>      </span><span class="token literal-property" style="color:#905">action</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&#x27;parse&#x27;</span><span class="token" style="color:#999">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">11</span><span>      </span><span class="token literal-property" style="color:#905">page</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> title</span><span class="token" style="color:#999">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">12</span><span>    </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">done</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">13</span><span>      </span><span class="token" style="color:#DD4A68">resolve</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">1</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">14</span><span>    </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">fail</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">15</span><span>      </span><span class="token" style="color:#DD4A68">resolve</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">0</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">16</span><span>    </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">17</span><span>  </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">18</span><span></span><span class="token" style="color:#999">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">19</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">20</span><span></span><span class="token" style="color:slategray">// 添加按钮至“Wiki工具”栏，可按需修改</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">21</span><span></span><span class="token" style="color:#DD4A68">$</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;#site-tools ul&#x27;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">append</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;&lt;li class=&quot;mw-list-item&quot; id=&quot;t-tradredirect&quot;&gt;&lt;a href=&quot;javascript:;&quot;&gt;创建繁体重定向&lt;/a&gt;&lt;/li&gt;&#x27;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">22</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">23</span><span></span><span class="token dom" style="color:#e90">document</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">getElementById</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;t-tradredirect&#x27;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">addEventListener</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;click&#x27;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#07a">async</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">24</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">25</span><span>  </span><span class="token" style="color:#07a">const</span><span> </span><span class="token function-variable" style="color:#DD4A68">msg</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token parameter">m</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token dom" style="color:#e90">document</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">getElementById</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;t-tradredirect&#x27;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token property-access">innerHTML</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> m</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">26</span><span>  </span><span class="token" style="color:#DD4A68">msg</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;请稍候&#x27;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">27</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">28</span><span>  </span><span class="token" style="color:#07a">let</span><span> title </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> mw</span><span class="token" style="color:#999">.</span><span class="token property-access">config</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">get</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;wgPageName&#x27;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">29</span><span>  </span><span class="token" style="color:slategray">// 使用了简体 -&gt; 台繁，如有需要也可增添港繁（将 tw 修改为 hk ）</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">30</span><span>  </span><span class="token" style="color:#07a">const</span><span> converter </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token maybe-class-name">OpenCC</span><span class="token" style="color:#999">.</span><span class="token method property-access maybe-class-name" style="color:#DD4A68">Converter</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">{</span><span> </span><span class="token module" style="color:#07a">from</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&#x27;cn&#x27;</span><span class="token" style="color:#999">,</span><span> </span><span class="token literal-property" style="color:#905">to</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&#x27;tw&#x27;</span><span> </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">31</span><span>  </span><span class="token" style="color:#07a">let</span><span> tradtitle </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#DD4A68">converter</span><span class="token" style="color:#999">(</span><span>title</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">32</span><span>  </span><span class="token control-flow" style="color:#07a">if</span><span> </span><span class="token" style="color:#999">(</span><span>tradtitle </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">==</span><span> title</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">33</span><span>    </span><span class="token" style="color:#DD4A68">msg</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;无需创建繁体重定向&#x27;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">34</span><span>    </span><span class="token control-flow" style="color:#07a">return</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">35</span><span>  </span><span class="token" style="color:#999">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">36</span><span>  </span><span class="token control-flow" style="color:#07a">if</span><span> </span><span class="token" style="color:#999">(</span><span class="token control-flow" style="color:#07a">await</span><span> </span><span class="token" style="color:#DD4A68">ifExist</span><span class="token" style="color:#999">(</span><span>tradtitle</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">37</span><span>    </span><span class="token" style="color:#DD4A68">msg</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;已有繁体重定向&#x27;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">38</span><span>    </span><span class="token control-flow" style="color:#07a">return</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">39</span><span>  </span><span class="token" style="color:#999">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">40</span><span>  </span><span class="token console" style="color:#DD4A68">console</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">log</span><span class="token" style="color:#999">(</span><span class="token template-string template-punctuation" style="color:#690">`</span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">${</span><span class="token template-string interpolation">tradtitle</span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">}</span><span class="token template-string" style="color:#690"> =&gt; </span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">${</span><span class="token template-string interpolation">title</span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">}</span><span class="token template-string template-punctuation" style="color:#690">`</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">41</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">42</span><span>  </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">mw</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">Api</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">postWithToken</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;csrf&#x27;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">43</span><span>    </span><span class="token literal-property" style="color:#905">action</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&#x27;edit&#x27;</span><span class="token" style="color:#999">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">44</span><span>    </span><span class="token literal-property" style="color:#905">text</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token template-string template-punctuation" style="color:#690">`</span><span class="token template-string" style="color:#690">#重定向 [[</span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">${</span><span class="token template-string interpolation">title</span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">}</span><span class="token template-string" style="color:#690">]]</span><span class="token template-string template-punctuation" style="color:#690">`</span><span class="token" style="color:#999">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">45</span><span>    </span><span class="token literal-property" style="color:#905">title</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> tradtitle</span><span class="token" style="color:#999">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">46</span><span>    </span><span class="token literal-property" style="color:#905">summary</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token template-string template-punctuation" style="color:#690">`</span><span class="token template-string" style="color:#690">创建繁体重定向</span><span class="token template-string template-punctuation" style="color:#690">`</span><span class="token" style="color:#999">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">47</span><span>    </span><span class="token literal-property" style="color:#905">errorformat</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&#x27;plaintext&#x27;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">48</span><span>  </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">done</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">49</span><span>    </span><span class="token" style="color:#DD4A68">msg</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;创建成功&#x27;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">50</span><span>  </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">fail</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">(</span><span class="token parameter">a</span><span class="token parameter" style="color:#999">,</span><span class="token parameter"> b</span><span class="token parameter" style="color:#999">,</span><span class="token parameter"> errorThrown</span><span class="token" style="color:#999">)</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">51</span><span>    </span><span class="token" style="color:#DD4A68">msg</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;出错了&#x27;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">52</span><span>    </span><span class="token console" style="color:#DD4A68">console</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">error</span><span class="token" style="color:#999">(</span><span>errorThrown</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">53</span><span>  </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">54</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">55</span><span></span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">56</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">57</span><span></span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span></code></div></pre>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">请注意，这里使用了 ES6 语法，若直接插入 <code class="text-gray-600 dark:text-white" node="[object Object]">`<!-- -->MediaWiki:Common.js<!-- -->`</code> 之类的页面，会出现错误。关于如何正确在 MediaWiki 中使用 ES6，后将撰文记录。</p>
<h3 class="sm:text-2xl text-2xl mt-12 mb-6 dark:text-white">Gadget</h3>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">可以利用 <a href="https://www.mediawiki.org/wiki/Extension:Gadgets" node="[object Object]" class="text-blue-500 hover:text-blue-800 after:content-[&#x27;_↗&#x27;] transition-colors duration-200">Gadgets</a> 插件将脚本设置为可供用户启用，便于编辑者自助添加繁体重定向。</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">为避免上述的 ES6 语法问题，首先需在别的页面存储脚本，如在自己的用户页下，此处以 <code class="text-gray-600 dark:text-white" node="[object Object]">`<!-- -->User:root/redirect.js<!-- -->`</code> 为例。之后，在 <code class="text-gray-600 dark:text-white" node="[object Object]">`<!-- -->MediaWiki:Gadget-GADGET.js<!-- -->`</code> 中使用 <code class="text-gray-600 dark:text-white" node="[object Object]">`<!-- -->mw.loader.load<!-- -->`</code> 引入脚本，其中 <code class="text-gray-600 dark:text-white" node="[object Object]">`<!-- -->GADGET<!-- -->`</code> 指的是为该 Gadget 取的内部名称。在该例中，可为之取名 <code class="text-gray-600 dark:text-white" node="[object Object]">`<!-- -->redirect<!-- -->`</code>，并在 <code class="text-gray-600 dark:text-white" node="[object Object]">`<!-- -->MediaWiki:Gadget-redirect.js<!-- -->`</code> 中写下如下代码：</p>
<pre><div node="[object Object]" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:1.8rem 0;overflow:auto;border-radius:0.5rem"><code class="font-en text-md" style="white-space:pre"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">1</span><span>mw</span><span class="token" style="color:#999">.</span><span class="token property-access">loader</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">load</span><span class="token" style="color:#999">(</span><span> </span><span class="token" style="color:#690">&#x27;/w/index.php?title=user:root/redirect.js&amp;action=raw&amp;ctype=text/javascript&#x27;</span><span> </span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span></code></div></pre>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">请留意此处不能直接复制存储页面链接，而应该添加参数使之加载为可执行脚本文件，否则会报错：</p>
<pre><div node="[object Object]" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:1.8rem 0;overflow:auto;border-radius:0.5rem"><code class="font-en text-md" style="white-space:pre"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">1</span><span>because its MIME </span><span class="token" style="color:#DD4A68">type</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;text/html&#x27;</span><span class="token" style="color:#999">)</span><span> is not executable</span></code></div></pre>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">之后，在 <code class="text-gray-600 dark:text-white" node="[object Object]">`<!-- -->MediaWiki:Gadget-redirect<!-- -->`</code> 中写下关于此 Gadget 的描述，也可以使用 wikitext。</p>
<pre><div node="[object Object]" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:1.8rem 0;overflow:auto;border-radius:0.5rem"><code class="font-en text-md" style="white-space:pre"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">1</span><span>在 Wiki 工具中增加快速添加繁体重定向的按钮</span></code></div></pre>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">最后，在 <code class="text-gray-600 dark:text-white" node="[object Object]">`<!-- -->MediaWiki:Gadgets-definition<!-- -->`</code> 中定义该 Gadget：</p>
<pre><div node="[object Object]" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:1.8rem 0;overflow:auto;border-radius:0.5rem"><code class="font-en text-md" style="white-space:pre"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">1</span><span>* redirect[ResourceLoader]|redirect.js</span></code></div></pre>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">启用 Gadget 后，最开始可能会跳出如下警告，并运行失败：</p>
<pre><div node="[object Object]" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:1.8rem 0;overflow:auto;border-radius:0.5rem"><code class="font-en text-md" style="white-space:pre"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">1</span><span>Skipped unavailable module ext.gadget.redirect</span></code></div></pre>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">但一段时间后即可成功启用，小编也不知道为什么。</p>
<div class="mt-12 mb-6"><h2 class="sm:text-3xl text-2xl dark:text-white">处理历史遗留问题</h2><hr class="dark:border-dashed mt-1"/></div>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">理论上，使用 Pywikibot 可以更妥当地批量处理先前的页面。然而，<a href="https://doc.wikimedia.org/pywikibot/stable/introduction.html" node="[object Object]" class="text-blue-500 hover:text-blue-800 after:content-[&#x27;_↗&#x27;] transition-colors duration-200">Pywikibot 的文档</a>看上去就很麻烦，而且本人 Python 水平比 JavaScript 更低。鉴于 DOL 中文 wiki 页面尚不算多，直接照前文又画了一个 JavaScript 脚本了事。到 wiki 的 <code class="text-gray-600 dark:text-white" node="[object Object]">`<!-- -->特殊:所有页面<!-- -->`</code>，在每一页打开控制台运行以下脚本即可。</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">建议使用机器人账户进行相关操作。</p>
<pre><div node="[object Object]" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:1.8rem 0;overflow:auto;border-radius:0.5rem"><code class="font-en text-md" style="white-space:pre"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">1</span><span class="token" style="color:#07a">const</span><span> </span><span class="token function-variable" style="color:#DD4A68">ifExist</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token parameter">title</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">2</span><span>  </span><span class="token control-flow" style="color:#07a">return</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">Promise</span><span class="token" style="color:#999">(</span><span class="token parameter">resolve</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">3</span><span>    </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">mw</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">Api</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">get</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">4</span><span>      </span><span class="token literal-property" style="color:#905">action</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&#x27;parse&#x27;</span><span class="token" style="color:#999">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">5</span><span>      </span><span class="token literal-property" style="color:#905">page</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> title</span><span class="token" style="color:#999">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">6</span><span>    </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">done</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">7</span><span>      </span><span class="token" style="color:#DD4A68">resolve</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">1</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">8</span><span>    </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">fail</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">9</span><span>      </span><span class="token" style="color:#DD4A68">resolve</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">0</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">10</span><span>    </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">11</span><span>  </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">12</span><span></span><span class="token" style="color:#999">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">13</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">14</span><span></span><span class="token" style="color:slategray">// 获取需操作页面的标题</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">15</span><span></span><span class="token" style="color:#07a">let</span><span> link_list </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#999">[</span><span class="token" style="color:#999">]</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">16</span><span></span><span class="token dom" style="color:#e90">document</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">querySelectorAll</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;.mw-allpages-body li a&#x27;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">forEach</span><span class="token" style="color:#999">(</span><span> </span><span class="token parameter">a</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">17</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">18</span><span>  </span><span class="token" style="color:slategray">// 排除重定向页面</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">19</span><span>  </span><span class="token control-flow" style="color:#07a">if</span><span> </span><span class="token" style="color:#999">(</span><span>a</span><span class="token" style="color:#999">.</span><span class="token property-access">classList</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">contains</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;mw-redirect&#x27;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span> </span><span class="token control-flow" style="color:#07a">return</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:#999">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">20</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">21</span><span>  </span><span class="token" style="color:#07a">let</span><span> title </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> a</span><span class="token" style="color:#999">.</span><span class="token property-access">innerText</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">22</span><span>  </span><span class="token" style="color:#07a">const</span><span> converter </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token maybe-class-name">OpenCC</span><span class="token" style="color:#999">.</span><span class="token method property-access maybe-class-name" style="color:#DD4A68">Converter</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">{</span><span> </span><span class="token module" style="color:#07a">from</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&#x27;cn&#x27;</span><span class="token" style="color:#999">,</span><span> </span><span class="token literal-property" style="color:#905">to</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&#x27;tw&#x27;</span><span> </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">23</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">24</span><span>  </span><span class="token" style="color:slategray">// 排除简繁标题一致页面</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">25</span><span>  </span><span class="token" style="color:#07a">let</span><span> tradtitle </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#DD4A68">converter</span><span class="token" style="color:#999">(</span><span>title</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">26</span><span>  </span><span class="token control-flow" style="color:#07a">if</span><span> </span><span class="token" style="color:#999">(</span><span>tradtitle </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">==</span><span> title</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span> </span><span class="token control-flow" style="color:#07a">return</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:#999">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">27</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">28</span><span>  link_list</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">push</span><span class="token" style="color:#999">(</span><span>title</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">29</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">30</span><span></span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">31</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">32</span><span>link_list</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">forEach</span><span class="token" style="color:#999">(</span><span> </span><span class="token" style="color:#07a">async</span><span> </span><span class="token" style="color:#999">(</span><span class="token parameter">title</span><span class="token" style="color:#999">)</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">33</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">34</span><span>  </span><span class="token" style="color:#07a">const</span><span> converter </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token maybe-class-name">OpenCC</span><span class="token" style="color:#999">.</span><span class="token method property-access maybe-class-name" style="color:#DD4A68">Converter</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">{</span><span> </span><span class="token module" style="color:#07a">from</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&#x27;cn&#x27;</span><span class="token" style="color:#999">,</span><span> </span><span class="token literal-property" style="color:#905">to</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&#x27;tw&#x27;</span><span> </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">35</span><span>  </span><span class="token" style="color:#07a">let</span><span> tradtitle </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#DD4A68">converter</span><span class="token" style="color:#999">(</span><span>title</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">36</span><span>  </span><span class="token control-flow" style="color:#07a">if</span><span> </span><span class="token" style="color:#999">(</span><span class="token control-flow" style="color:#07a">await</span><span> </span><span class="token" style="color:#DD4A68">ifExist</span><span class="token" style="color:#999">(</span><span>tradtitle</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">37</span><span>    </span><span class="token console" style="color:#DD4A68">console</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">log</span><span class="token" style="color:#999">(</span><span class="token template-string template-punctuation" style="color:#690">`</span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">${</span><span class="token template-string interpolation">tradtitle</span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">}</span><span class="token template-string" style="color:#690"> =&gt; </span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">${</span><span class="token template-string interpolation">title</span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">}</span><span class="token template-string" style="color:#690">已有繁体重定向</span><span class="token template-string template-punctuation" style="color:#690">`</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">38</span><span>    </span><span class="token control-flow" style="color:#07a">return</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">39</span><span>  </span><span class="token" style="color:#999">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">40</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">41</span><span>  </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">mw</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">Api</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">postWithToken</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;csrf&#x27;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">42</span><span>    </span><span class="token literal-property" style="color:#905">action</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&#x27;edit&#x27;</span><span class="token" style="color:#999">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">43</span><span>    </span><span class="token literal-property" style="color:#905">text</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token template-string template-punctuation" style="color:#690">`</span><span class="token template-string" style="color:#690">#重定向 [[</span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">${</span><span class="token template-string interpolation">title</span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">}</span><span class="token template-string" style="color:#690">]]</span><span class="token template-string template-punctuation" style="color:#690">`</span><span class="token" style="color:#999">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">44</span><span>    </span><span class="token literal-property" style="color:#905">title</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> tradtitle</span><span class="token" style="color:#999">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">45</span><span>    </span><span class="token literal-property" style="color:#905">bot</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#905">true</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:slategray">// 标记为机器人操作，避免刷屏</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">46</span><span>    </span><span class="token literal-property" style="color:#905">summary</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token template-string template-punctuation" style="color:#690">`</span><span class="token template-string" style="color:#690">创建繁体重定向</span><span class="token template-string template-punctuation" style="color:#690">`</span><span class="token" style="color:#999">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">47</span><span>    </span><span class="token literal-property" style="color:#905">errorformat</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&#x27;plaintext&#x27;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">48</span><span>  </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">done</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">49</span><span>    </span><span class="token console" style="color:#DD4A68">console</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">log</span><span class="token" style="color:#999">(</span><span class="token template-string template-punctuation" style="color:#690">`</span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">${</span><span class="token template-string interpolation">tradtitle</span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">}</span><span class="token template-string" style="color:#690"> =&gt; </span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">${</span><span class="token template-string interpolation">title</span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">}</span><span class="token template-string" style="color:#690">创建成功</span><span class="token template-string template-punctuation" style="color:#690">`</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">50</span><span>  </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">fail</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">(</span><span class="token parameter">a</span><span class="token parameter" style="color:#999">,</span><span class="token parameter"> b</span><span class="token parameter" style="color:#999">,</span><span class="token parameter"> errorThrown</span><span class="token" style="color:#999">)</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">51</span><span>    </span><span class="token console" style="color:#DD4A68">console</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">error</span><span class="token" style="color:#999">(</span><span class="token template-string template-punctuation" style="color:#690">`</span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">${</span><span class="token template-string interpolation">tradtitle</span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">}</span><span class="token template-string" style="color:#690"> =&gt; </span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">${</span><span class="token template-string interpolation">title</span><span class="token template-string interpolation interpolation-punctuation" style="color:#999">}</span><span class="token template-string" style="color:#690">创建出错</span><span class="token template-string template-punctuation" style="color:#690">`</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">52</span><span>    </span><span class="token console" style="color:#DD4A68">console</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">error</span><span class="token" style="color:#999">(</span><span>errorThrown</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">53</span><span>  </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">54</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">55</span><span></span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span></code></div></pre></div><br/><div></div><a class="float-right mt-10 sm:text-2xl text-xl text-gray-500 hover:text-black transition-colors duration-200 dark:text-gray-400 dark:hover:text-gray-100" href="/note">cd ..</a></div></main><footer class="container mx-auto text-center text-gray-700 dark:text-gray-400"><div class="flex flex-row justify-center mb-5 space-x-5"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.8em" height="1.8em" viewBox="0 0 24 24" class="cursor-pointer"><path fill="currentColor" fill-rule="evenodd" d="M3.5 3.25a.75.75 0 0 1 .75-.75C14.053 2.5 22 10.447 22 20.25a.75.75 0 0 1-1.5 0C20.5 11.275 13.225 4 4.25 4a.75.75 0 0 1-.75-.75zM3.5 19a2 2 0 1 1 4 0a2 2 0 0 1-4 0zm.75-9.5a.75.75 0 0 0 0 1.5a9.25 9.25 0 0 1 9.25 9.25a.75.75 0 0 0 1.5 0C15 14.313 10.187 9.5 4.25 9.5z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.8em" height="1.8em" viewBox="0 0 24 24" class="cursor-pointer"><path fill="currentColor" d="M4 20q-.825 0-1.412-.587Q2 18.825 2 18V6q0-.825.588-1.412Q3.175 4 4 4h16q.825 0 1.413.588Q22 5.175 22 6v12q0 .825-.587 1.413Q20.825 20 20 20ZM20 8l-7.475 4.675q-.125.075-.263.112q-.137.038-.262.038t-.262-.038q-.138-.037-.263-.112L4 8v10h16Zm-8 3l8-5H4ZM4 8v.25v-1.475v.025V6v.8v-.013V8.25V8v10Z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.8em" height="1.8em" cursor="pointer" viewBox="0 0 16 16"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5.75 14.25s-.5-2 .5-3c0 0-2 0-3.5-1.5s-1-4.5 0-5.5c-.5-1.5.5-2.5.5-2.5s1.5 0 2.5 1c1-.5 3.5-.5 4.5 0c1-1 2.5-1 2.5-1s1 1 .5 2.5c1 1 1.5 4 0 5.5s-3.5 1.5-3.5 1.5c1 1 .5 3 .5 3m-5-.5c-1.5.5-3-.5-3.5-1"></path></svg></div><div class="mb-10 font-en">©<!-- -->2024<!-- -->. All rights reserved by <a href="https://github.com/omvjro" class="text-blue-500 hover:text-blue-900 transition-colors duration-300">omvjro</a>. Powered by <a href="https://github.com/qianxi0410/gossip" class="text-blue-500 hover:text-blue-900 transition-colors duration-300">Gossip</a>.</div></footer><div class="bottom-10 right-10 cursor-pointer fixed hidden lg:block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.8em" height="1.8em" viewBox="0 0 24 24" class="opacity-0 duration-700 transition-opacity ease-in-out"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19h14a2 2 0 0 0 1.84-2.75L13.74 4a2 2 0 0 0-3.5 0l-7.1 12.25A2 2 0 0 0 4.89 19"></path></svg></div></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"post":{"id":3,"title":"MediaWiki 语言变体补遗","created_at":"2024-05-13T05:16:56Z","updated_at":"2024-05-13T05:17:04Z","content":"如先前所述，利用 JavaScript 实现的变体转换存在需要额外创建繁体标题重定向的问题。和更改站点内容语言一样，对于已有一定规模的 wiki 来说，这是很麻烦的一件事。\r\n\r\n## 手动创建脚本\r\n\r\n利用此脚本可以为每个页面添加快速创建繁体重定向的按钮，所依赖的 API 有 jQuery、[openccjs](https://github.com/nk2028/opencc-js)，以及 MediaWiki 自身提供的 [Action API](https://www.mediawiki.org/wiki/API:Main_page)。\r\n\r\n```js\r\n$(function () {\r\n\r\n// 仅在内容页面启用\r\nif (!mw.config.get( 'wgIsArticle' ) || mw.config.get( 'wgPageContentModel' ) !== 'wikitext') { return }\r\n\r\n// 检查重定向页面是否已存在\r\nconst ifExist = title =\u003e {\r\n  return new Promise(resolve =\u003e {\r\n    new mw.Api().get({\r\n      action: 'parse',\r\n      page: title,\r\n    }).done(() =\u003e {\r\n      resolve(1);\r\n    }).fail(() =\u003e {\r\n      resolve(0);\r\n    });\r\n  });\r\n}\r\n\r\n// 添加按钮至“Wiki工具”栏，可按需修改\r\n$('#site-tools ul').append('\u003cli class=\"mw-list-item\" id=\"t-tradredirect\"\u003e\u003ca href=\"javascript:;\"\u003e创建繁体重定向\u003c/a\u003e\u003c/li\u003e');\r\n\r\ndocument.getElementById('t-tradredirect').addEventListener('click', async () =\u003e {\r\n\r\n  const msg = m =\u003e document.getElementById('t-tradredirect').innerHTML = m;\r\n  msg('请稍候');\r\n\r\n  let title = mw.config.get('wgPageName');\r\n  // 使用了简体 -\u003e 台繁，如有需要也可增添港繁（将 tw 修改为 hk ）\r\n  const converter = OpenCC.Converter({ from: 'cn', to: 'tw' });\r\n  let tradtitle = converter(title);\r\n  if (tradtitle == title) {\r\n    msg('无需创建繁体重定向');\r\n    return;\r\n  }\r\n  if (await ifExist(tradtitle)) {\r\n    msg('已有繁体重定向');\r\n    return;\r\n  }\r\n  console.log(`${tradtitle} =\u003e ${title}`);\r\n\r\n  new mw.Api().postWithToken('csrf', {\r\n    action: 'edit',\r\n    text: `#重定向 [[${title}]]`,\r\n    title: tradtitle,\r\n    summary: `创建繁体重定向`,\r\n    errorformat: 'plaintext'\r\n  }).done(() =\u003e {\r\n    msg('创建成功');\r\n  }).fail((a, b, errorThrown) =\u003e {\r\n    msg('出错了');\r\n    console.error(errorThrown);\r\n  });\r\n\r\n});\r\n\r\n});\r\n```\r\n\r\n请注意，这里使用了 ES6 语法，若直接插入 `MediaWiki:Common.js` 之类的页面，会出现错误。关于如何正确在 MediaWiki 中使用 ES6，后将撰文记录。\r\n\r\n### Gadget\r\n\r\n可以利用 [Gadgets](https://www.mediawiki.org/wiki/Extension:Gadgets) 插件将脚本设置为可供用户启用，便于编辑者自助添加繁体重定向。\r\n\r\n为避免上述的 ES6 语法问题，首先需在别的页面存储脚本，如在自己的用户页下，此处以 `User:root/redirect.js` 为例。之后，在 `MediaWiki:Gadget-GADGET.js` 中使用 `mw.loader.load` 引入脚本，其中 `GADGET` 指的是为该 Gadget 取的内部名称。在该例中，可为之取名 `redirect`，并在 `MediaWiki:Gadget-redirect.js` 中写下如下代码：\r\n\r\n```js\r\nmw.loader.load( '/w/index.php?title=user:root/redirect.js\u0026action=raw\u0026ctype=text/javascript' );\r\n```\r\n\r\n请留意此处不能直接复制存储页面链接，而应该添加参数使之加载为可执行脚本文件，否则会报错：\r\n\r\n```\r\nbecause its MIME type ('text/html') is not executable\r\n```\r\n\r\n之后，在 `MediaWiki:Gadget-redirect` 中写下关于此 Gadget 的描述，也可以使用 wikitext。\r\n\r\n```wikitext\r\n在 Wiki 工具中增加快速添加繁体重定向的按钮\r\n```\r\n\r\n最后，在 `MediaWiki:Gadgets-definition` 中定义该 Gadget：\r\n\r\n```wikitext\r\n* redirect[ResourceLoader]|redirect.js\r\n```\r\n\r\n启用 Gadget 后，最开始可能会跳出如下警告，并运行失败：\r\n\r\n```\r\nSkipped unavailable module ext.gadget.redirect\r\n```\r\n\r\n但一段时间后即可成功启用，小编也不知道为什么。\r\n\r\n## 处理历史遗留问题\r\n\r\n理论上，使用 Pywikibot 可以更妥当地批量处理先前的页面。然而，[Pywikibot 的文档](https://doc.wikimedia.org/pywikibot/stable/introduction.html)看上去就很麻烦，而且本人 Python 水平比 JavaScript 更低。鉴于 DOL 中文 wiki 页面尚不算多，直接照前文又画了一个 JavaScript 脚本了事。到 wiki 的 `特殊:所有页面`，在每一页打开控制台运行以下脚本即可。\r\n\r\n建议使用机器人账户进行相关操作。\r\n\r\n```js\r\nconst ifExist = title =\u003e {\r\n  return new Promise(resolve =\u003e {\r\n    new mw.Api().get({\r\n      action: 'parse',\r\n      page: title,\r\n    }).done(() =\u003e {\r\n      resolve(1);\r\n    }).fail(() =\u003e {\r\n      resolve(0);\r\n    });\r\n  });\r\n}\r\n\r\n// 获取需操作页面的标题\r\nlet link_list = [];\r\ndocument.querySelectorAll('.mw-allpages-body li a').forEach( a =\u003e {\r\n\r\n  // 排除重定向页面\r\n  if (a.classList.contains('mw-redirect')) { return; }\r\n\r\n  let title = a.innerText;\r\n  const converter = OpenCC.Converter({ from: 'cn', to: 'tw' });\r\n\r\n  // 排除简繁标题一致页面\r\n  let tradtitle = converter(title);\r\n  if (tradtitle == title) { return; }\r\n\r\n  link_list.push(title);\r\n\r\n});\r\n\r\nlink_list.forEach( async (title) =\u003e {\r\n\r\n  const converter = OpenCC.Converter({ from: 'cn', to: 'tw' });\r\n  let tradtitle = converter(title);\r\n  if (await ifExist(tradtitle)) {\r\n    console.log(`${tradtitle} =\u003e ${title}已有繁体重定向`);\r\n    return;\r\n  }\r\n\r\n  new mw.Api().postWithToken('csrf', {\r\n    action: 'edit',\r\n    text: `#重定向 [[${title}]]`,\r\n    title: tradtitle,\r\n    bot: true, // 标记为机器人操作，避免刷屏\r\n    summary: `创建繁体重定向`,\r\n    errorformat: 'plaintext'\r\n  }).done(() =\u003e {\r\n    console.log(`${tradtitle} =\u003e ${title}创建成功`);\r\n  }).fail((a, b, errorThrown) =\u003e {\r\n    console.error(`${tradtitle} =\u003e ${title}创建出错`);\r\n    console.error(errorThrown);\r\n  });\r\n\r\n});\r\n```\r\n","author":"omvjro","reactions":{"url":"https://api.github.com/repos/omvjro/note/issues/3/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"labels":["published","MediaWiki"]}},"__N_SSG":true},"page":"/post/[id]","query":{"id":"MediaWiki 语言变体补遗"},"buildId":"oTtmgtPvCncH-HN5g4SuZ","assetPrefix":"/note","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>